<!Doctype html>
<html>
	<head>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="less/css-card.css">
	</head>
	<body>
		<button> OK </button>

		<div class="sliced">
			<img src="images/blue_wheel.png" />
			<img src="images/rcorper_collage_back.jpg"/>
		</div> 

		<script type="text/javascript">
			(function( $, window ) {

			var _defaults = {
				x: 2, // number of tiles in x axis
				y: 2, // number of tiles in y axis
				random : true, // animate tiles in random order
				speed: 2000 // time to clear all times
			};

			/**
			* range Get an array of numbers within a range
			* @param min {number} Lowest number in array
			* @param max {number} Highest number in array
			* @param rand {bool} Shuffle array
			* @return {array}
			*/
			function range( min, max, rand ) {
				var arr = ( new Array( ++max - min ) )
				.join('.').split('.')
				.map(function( v,i ){ return min + i })
				return rand
				? arr.map(function( v ) { return [ Math.random(), v ] })
					 .sort().map(function( v ) { return v[ 1 ] })
				: arr
			}
			
			// Prevent css3 transitions on load
			$('body').addClass('css3-preload')
			$( window ).load(function(){ $('body').removeClass('css3-preload') })

			$.fn.sliced = function( options ) {
				var o = $.extend( {}, _defaults, options);

				return this.each(function() {

					var $container = $(this);
					window.c = $container;
					var width = $container.find('img').width(),
						height = $container.find('img').height(),
						$img = $('img', $container),
						n_tiles = o.x * o.y,
						tiles = [], $tiles;

					for ( var i = 0; i < n_tiles; i++ ) {
						tiles.push('<div class="tile"><div class="card"><div class="card-front face"></div><div class="card-back face"></div></div></div>');
					}

					$tiles = $( tiles.join('') );

					// Hide original image and insert tiles in DOM
					$img.hide();
					$container.after( $tiles );

					// Set background
					$tiles.css({
						width: width / o.x,
						height: height / o.y,
					});

					//Set the first image as the front side.
					$('.card-front', $tiles).css('backgroundImage', 'url('+ $($img[0]).attr('src') +')');

					//Set the second image as the back side.
					$('.card-back', $tiles).css('backgroundImage', 'url('+ $($img[1]).attr('src') +')');

					// Adjust position
					$tiles.each(function(e) {
						var pos = $(this).position();
						var translateX = (e % o.x) * (width / o.x);
						var translateY = Math.floor (e / o.x) * (height / o.y);

						$('.card-front, .card-back', this).css( 'backgroundPosition', -translateX +'px '+ -translateY +'px' );
					});

					var tilesArr = range( 0, n_tiles, o.random ),
						tileSpeed = o.speed / n_tiles; // time to clear a single tile

					// Public method
					$container.on( 'animate', function() {
						tilesArr.forEach(function( tile, i ) {
							setTimeout(function(){
								$tiles.eq( tile ).toggleClass( 'tile-flip' );
							}, i * tileSpeed );
						});
					});
				});
			};

			}( jQuery, window ));

			$('.sliced').sliced({ x: 6, y: 9, speed: 4000 });

			$('button').click(function() {
				$('.sliced').trigger('animate');
			});
		</script>
	</body>

</html>